<!DOCTYPE html>
<html>
<head>
    <title>This Reference Test</title>
</head>
<body>
    <button id="classBtn">Class Button</button>
    <button id="arrowBtn">Arrow Function Button</button>
    <button id="bindBtn">Bind Button</button>
    <button id="globalBtn">Global Button</button>
    <div id="result"></div>
    
    <script>
        // テスト用のES6クラス
        class TestClass {
            constructor() {
                this.count = 0;
                this.name = 'TestClass';
                
                // 各種イベント登録方式
                const classBtn = document.getElementById('classBtn');
                const arrowBtn = document.getElementById('arrowBtn');
                const bindBtn = document.getElementById('bindBtn');
                
                // 1. 通常の関数（thisが失われる）
                classBtn.addEventListener('click', function() {
                    try {
                        this.count++;
                        document.getElementById('result').innerHTML += `<p>Class method: ${this.count}</p>`;
                    } catch (e) {
                        document.getElementById('result').innerHTML += `<p>Class method error: ${e.message}</p>`;
                        console.error('Class method error:', e);
                    }
                });
                
                // 2. アロー関数（thisが保持される）
                arrowBtn.addEventListener('click', () => {
                    try {
                        this.count++;
                        document.getElementById('result').innerHTML += `<p>Arrow function: ${this.count}</p>`;
                    } catch (e) {
                        document.getElementById('result').innerHTML += `<p>Arrow function error: ${e.message}</p>`;
                        console.error('Arrow function error:', e);
                    }
                });
                
                // 3. bind使用（thisが保持される）
                bindBtn.addEventListener('click', this.handleClick.bind(this));
            }
            
            handleClick() {
                try {
                    this.count++;
                    document.getElementById('result').innerHTML += `<p>Bind method: ${this.count}</p>`;
                } catch (e) {
                    document.getElementById('result').innerHTML += `<p>Bind method error: ${e.message}</p>`;
                    console.error('Bind method error:', e);
                }
            }
        }
        
        // グローバル変数方式
        window.globalCounter = {
            count: 0
        };
        
        document.getElementById('globalBtn').onclick = function() {
            window.globalCounter.count++;
            document.getElementById('result').innerHTML += `<p>Global method: ${window.globalCounter.count}</p>`;
        };
        
        // クラスをインスタンス化
        const testInstance = new TestClass();
        window.testInstance = testInstance; // テスト用にグローバルに公開
    </script>
</body>
</html>